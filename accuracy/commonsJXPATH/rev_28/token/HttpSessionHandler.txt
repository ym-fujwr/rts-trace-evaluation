package
org
.
apache
.
commons
.
jxpath
.
servlet
;
import
java
.
util
.
Enumeration
;
import
java
.
util
.
HashSet
;
import
javax
.
servlet
.
http
.
HttpSession
;
import
org
.
apache
.
commons
.
jxpath
.
JXPathException
;
public
class
HttpSessionHandler
extends
ServletContextHandler
{
@
Override
protected
void
collectPropertyNames
(
final
HashSet
set
,
final
Object
bean
)
{
final
HttpSessionAndServletContext
handle
=
(
HttpSessionAndServletContext
)
bean
;
super
.
collectPropertyNames
(
set
,
handle
.
getServletContext
(
)
)
;
final
HttpSession
session
=
handle
.
getSession
(
)
;
if
(
session
!=
null
)
{
final
Enumeration
e
=
session
.
getAttributeNames
(
)
;
while
(
e
.
hasMoreElements
(
)
)
{
set
.
add
(
e
.
nextElement
(
)
)
;
}
}
}
@
Override
public
Object
getProperty
(
final
Object
bean
,
final
String
property
)
{
final
HttpSessionAndServletContext
handle
=
(
HttpSessionAndServletContext
)
bean
;
final
HttpSession
session
=
handle
.
getSession
(
)
;
if
(
session
!=
null
)
{
final
Object
object
=
session
.
getAttribute
(
property
)
;
if
(
object
!=
null
)
{
return
object
;
}
}
return
super
.
getProperty
(
handle
.
getServletContext
(
)
,
property
)
;
}
@
Override
public
void
setProperty
(
final
Object
bean
,
final
String
property
,
final
Object
value
)
{
final
HttpSessionAndServletContext
handle
=
(
HttpSessionAndServletContext
)
bean
;
final
HttpSession
session
=
handle
.
getSession
(
)
;
if
(
session
!=
null
)
{
session
.
setAttribute
(
property
,
value
)
;
}
else
{
throw
new
JXPathException
(
"Cannot set session attribute: "
+
"there is no session"
)
;
}
}
}
<EOF>
