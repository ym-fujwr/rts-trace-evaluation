package
org
.
apache
.
commons
.
jxpath
.
ri
.
axes
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
EvalContext
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
compiler
.
NodeTest
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
model
.
NodePointer
;
public
class
ParentContext
extends
EvalContext
{
private
final
NodeTest
nodeTest
;
private
boolean
setStarted
=
false
;
private
NodePointer
currentNodePointer
;
public
ParentContext
(
final
EvalContext
parentContext
,
final
NodeTest
nodeTest
)
{
super
(
parentContext
)
;
this
.
nodeTest
=
nodeTest
;
}
@
Override
public
NodePointer
getCurrentNodePointer
(
)
{
return
currentNodePointer
;
}
@
Override
public
int
getCurrentPosition
(
)
{
return
1
;
}
@
Override
public
int
getDocumentOrder
(
)
{
return
-
1
;
}
@
Override
public
void
reset
(
)
{
super
.
reset
(
)
;
setStarted
=
false
;
}
@
Override
public
boolean
setPosition
(
final
int
position
)
{
super
.
setPosition
(
position
)
;
return
position
==
1
;
}
@
Override
public
boolean
nextNode
(
)
{
if
(
setStarted
)
{
return
false
;
}
setStarted
=
true
;
final
NodePointer
thisLocation
=
parentContext
.
getCurrentNodePointer
(
)
;
currentNodePointer
=
thisLocation
.
getImmediateParentPointer
(
)
;
while
(
currentNodePointer
!=
null
&&
currentNodePointer
.
isContainer
(
)
)
{
currentNodePointer
=
currentNodePointer
.
getImmediateParentPointer
(
)
;
}
if
(
currentNodePointer
!=
null
&&
currentNodePointer
.
testNode
(
nodeTest
)
)
{
position
++
;
return
true
;
}
return
false
;
}
}
<EOF>
