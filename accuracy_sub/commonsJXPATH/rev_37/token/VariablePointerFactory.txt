package
org
.
apache
.
commons
.
jxpath
.
ri
.
model
;
import
java
.
util
.
Locale
;
import
org
.
apache
.
commons
.
jxpath
.
JXPathContext
;
import
org
.
apache
.
commons
.
jxpath
.
Variables
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
QName
;
public
class
VariablePointerFactory
implements
NodePointerFactory
{
public
static
final
int
VARIABLE_POINTER_FACTORY_ORDER
=
890
;
public
static
final
class
VariableContextWrapper
{
private
final
JXPathContext
context
;
private
VariableContextWrapper
(
final
JXPathContext
context
)
{
this
.
context
=
context
;
}
public
JXPathContext
getContext
(
)
{
return
context
;
}
}
public
static
VariableContextWrapper
contextWrapper
(
final
JXPathContext
context
)
{
return
new
VariableContextWrapper
(
context
)
;
}
@
Override
public
NodePointer
createNodePointer
(
final
QName
name
,
final
Object
object
,
final
Locale
locale
)
{
if
(
object
instanceof
VariableContextWrapper
)
{
JXPathContext
varCtx
=
(
(
VariableContextWrapper
)
object
)
.
getContext
(
)
;
while
(
varCtx
!=
null
)
{
final
Variables
vars
=
varCtx
.
getVariables
(
)
;
if
(
vars
.
isDeclaredVariable
(
name
.
toString
(
)
)
)
{
return
new
VariablePointer
(
vars
,
name
)
;
}
varCtx
=
varCtx
.
getParentContext
(
)
;
}
return
new
VariablePointer
(
name
)
;
}
return
null
;
}
@
Override
public
NodePointer
createNodePointer
(
final
NodePointer
parent
,
final
QName
name
,
final
Object
object
)
{
return
createNodePointer
(
name
,
object
,
null
)
;
}
@
Override
public
int
getOrder
(
)
{
return
VARIABLE_POINTER_FACTORY_ORDER
;
}
}
<EOF>
