package
org
.
apache
.
commons
.
jxpath
.
ri
.
axes
;
import
org
.
apache
.
commons
.
jxpath
.
Pointer
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
EvalContext
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
compiler
.
NodeTest
;
import
org
.
apache
.
commons
.
jxpath
.
ri
.
model
.
NodePointer
;
public
class
SelfContext
extends
EvalContext
{
private
final
NodeTest
nodeTest
;
private
boolean
startedSet
=
false
;
private
NodePointer
nodePointer
;
public
SelfContext
(
final
EvalContext
parentContext
,
final
NodeTest
nodeTest
)
{
super
(
parentContext
)
;
this
.
nodeTest
=
nodeTest
;
}
@
Override
public
Pointer
getSingleNodePointer
(
)
{
return
parentContext
.
getSingleNodePointer
(
)
;
}
@
Override
public
NodePointer
getCurrentNodePointer
(
)
{
if
(
position
==
0
&&
!
setPosition
(
1
)
)
{
return
null
;
}
return
nodePointer
;
}
@
Override
public
boolean
nextNode
(
)
{
return
setPosition
(
getCurrentPosition
(
)
+
1
)
;
}
@
Override
public
void
reset
(
)
{
super
.
reset
(
)
;
startedSet
=
false
;
}
@
Override
public
boolean
setPosition
(
final
int
position
)
{
if
(
position
!=
1
)
{
return
false
;
}
super
.
setPosition
(
position
)
;
if
(
!
startedSet
)
{
startedSet
=
true
;
nodePointer
=
parentContext
.
getCurrentNodePointer
(
)
;
}
if
(
nodePointer
==
null
)
{
return
false
;
}
return
nodeTest
==
null
||
nodePointer
.
testNode
(
nodeTest
)
;
}
}
<EOF>
