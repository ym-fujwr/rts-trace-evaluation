package
org
.
apache
.
commons
.
net
.
ftp
.
parser
;
import
java
.
text
.
ParseException
;
import
java
.
util
.
regex
.
Pattern
;
import
org
.
apache
.
commons
.
net
.
ftp
.
Configurable
;
import
org
.
apache
.
commons
.
net
.
ftp
.
FTPClientConfig
;
import
org
.
apache
.
commons
.
net
.
ftp
.
FTPFile
;
public
class
NTFTPEntryParser
extends
ConfigurableFTPFileEntryParserImpl
{
private
static
final
String
DEFAULT_DATE_FORMAT
=
"MM-dd-yy hh:mma"
;
private
static
final
String
DEFAULT_DATE_FORMAT2
=
"MM-dd-yy kk:mm"
;
private
static
final
String
REGEX
=
"(\\S+)\\s+(\\S+)\\s+"
+
"(?:(<DIR>)|([0-9]+))\\s+"
+
"(\\S.*)"
;
private
final
FTPTimestampParser
timestampParser
;
public
NTFTPEntryParser
(
)
{
this
(
null
)
;
}
public
NTFTPEntryParser
(
final
FTPClientConfig
config
)
{
super
(
REGEX
,
Pattern
.
DOTALL
)
;
configure
(
config
)
;
final
FTPClientConfig
config2
=
new
FTPClientConfig
(
FTPClientConfig
.
SYST_NT
,
DEFAULT_DATE_FORMAT2
,
null
)
;
config2
.
setDefaultDateFormatStr
(
DEFAULT_DATE_FORMAT2
)
;
this
.
timestampParser
=
new
FTPTimestampParserImpl
(
)
;
(
(
Configurable
)
this
.
timestampParser
)
.
configure
(
config2
)
;
}
@
Override
public
FTPClientConfig
getDefaultConfiguration
(
)
{
return
new
FTPClientConfig
(
FTPClientConfig
.
SYST_NT
,
DEFAULT_DATE_FORMAT
,
null
)
;
}
@
Override
public
FTPFile
parseFTPEntry
(
final
String
entry
)
{
final
FTPFile
f
=
new
FTPFile
(
)
;
f
.
setRawListing
(
entry
)
;
if
(
matches
(
entry
)
)
{
final
String
datestr
=
group
(
1
)
+
" "
+
group
(
2
)
;
final
String
dirString
=
group
(
3
)
;
final
String
size
=
group
(
4
)
;
final
String
name
=
group
(
5
)
;
try
{
f
.
setTimestamp
(
super
.
parseTimestamp
(
datestr
)
)
;
}
catch
(
final
ParseException
e
)
{
try
{
f
.
setTimestamp
(
timestampParser
.
parseTimestamp
(
datestr
)
)
;
}
catch
(
final
ParseException
e2
)
{
}
}
if
(
null
==
name
||
name
.
equals
(
"."
)
||
name
.
equals
(
".."
)
)
{
return
null
;
}
f
.
setName
(
name
)
;
if
(
"<DIR>"
.
equals
(
dirString
)
)
{
f
.
setType
(
FTPFile
.
DIRECTORY_TYPE
)
;
f
.
setSize
(
0
)
;
}
else
{
f
.
setType
(
FTPFile
.
FILE_TYPE
)
;
if
(
null
!=
size
)
{
f
.
setSize
(
Long
.
parseLong
(
size
)
)
;
}
}
return
f
;
}
return
null
;
}
}
<EOF>
