package
org
.
apache
.
commons
.
net
.
ftp
.
parser
;
import
java
.
text
.
ParseException
;
import
org
.
apache
.
commons
.
net
.
ftp
.
FTPClientConfig
;
import
org
.
apache
.
commons
.
net
.
ftp
.
FTPFile
;
public
class
NetwareFTPEntryParser
extends
ConfigurableFTPFileEntryParserImpl
{
private
static
final
String
DEFAULT_DATE_FORMAT
=
"MMM dd yyyy"
;
private
static
final
String
DEFAULT_RECENT_DATE_FORMAT
=
"MMM dd HH:mm"
;
private
static
final
String
REGEX
=
"(d|-){1}\\s+"
+
"\\[([-A-Z]+)\\]\\s+"
+
"(\\S+)\\s+"
+
"(\\d+)\\s+"
+
"(\\S+\\s+\\S+\\s+((\\d+:\\d+)|(\\d{4})))"
+
"\\s+(.*)"
;
public
NetwareFTPEntryParser
(
)
{
this
(
null
)
;
}
public
NetwareFTPEntryParser
(
final
FTPClientConfig
config
)
{
super
(
REGEX
)
;
configure
(
config
)
;
}
@
Override
protected
FTPClientConfig
getDefaultConfiguration
(
)
{
return
new
FTPClientConfig
(
FTPClientConfig
.
SYST_NETWARE
,
DEFAULT_DATE_FORMAT
,
DEFAULT_RECENT_DATE_FORMAT
)
;
}
@
Override
public
FTPFile
parseFTPEntry
(
final
String
entry
)
{
final
FTPFile
f
=
new
FTPFile
(
)
;
if
(
matches
(
entry
)
)
{
final
String
dirString
=
group
(
1
)
;
final
String
attrib
=
group
(
2
)
;
final
String
user
=
group
(
3
)
;
final
String
size
=
group
(
4
)
;
final
String
datestr
=
group
(
5
)
;
final
String
name
=
group
(
9
)
;
try
{
f
.
setTimestamp
(
super
.
parseTimestamp
(
datestr
)
)
;
}
catch
(
final
ParseException
e
)
{
}
if
(
dirString
.
trim
(
)
.
equals
(
"d"
)
)
{
f
.
setType
(
FTPFile
.
DIRECTORY_TYPE
)
;
}
else
{
f
.
setType
(
FTPFile
.
FILE_TYPE
)
;
}
f
.
setUser
(
user
)
;
f
.
setName
(
name
.
trim
(
)
)
;
f
.
setSize
(
Long
.
parseLong
(
size
.
trim
(
)
)
)
;
if
(
attrib
.
indexOf
(
'R'
)
!=
-
1
)
{
f
.
setPermission
(
FTPFile
.
USER_ACCESS
,
FTPFile
.
READ_PERMISSION
,
true
)
;
}
if
(
attrib
.
indexOf
(
'W'
)
!=
-
1
)
{
f
.
setPermission
(
FTPFile
.
USER_ACCESS
,
FTPFile
.
WRITE_PERMISSION
,
true
)
;
}
return
f
;
}
return
null
;
}
}
<EOF>
