package
org
.
apache
.
commons
.
net
.
nntp
;
import
java
.
io
.
BufferedReader
;
import
java
.
io
.
IOException
;
import
java
.
util
.
Iterator
;
import
java
.
util
.
NoSuchElementException
;
import
org
.
apache
.
commons
.
net
.
io
.
DotTerminatedMessageReader
;
import
org
.
apache
.
commons
.
net
.
io
.
Util
;
class
ReplyIterator
implements
Iterator
<
String
>
,
Iterable
<
String
>
{
private
final
BufferedReader
reader
;
private
String
line
;
private
Exception
savedException
;
ReplyIterator
(
final
BufferedReader
_reader
)
throws
IOException
{
this
(
_reader
,
true
)
;
}
ReplyIterator
(
final
BufferedReader
_reader
,
final
boolean
addDotReader
)
throws
IOException
{
reader
=
addDotReader
?
new
DotTerminatedMessageReader
(
_reader
)
:
_reader
;
line
=
reader
.
readLine
(
)
;
if
(
line
==
null
)
{
Util
.
closeQuietly
(
reader
)
;
}
}
@
Override
public
boolean
hasNext
(
)
{
if
(
savedException
!=
null
)
{
throw
new
NoSuchElementException
(
savedException
.
toString
(
)
)
;
}
return
line
!=
null
;
}
@
Override
public
Iterator
<
String
>
iterator
(
)
{
return
this
;
}
@
Override
public
String
next
(
)
throws
NoSuchElementException
{
if
(
savedException
!=
null
)
{
throw
new
NoSuchElementException
(
savedException
.
toString
(
)
)
;
}
final
String
prev
=
line
;
if
(
prev
==
null
)
{
throw
new
NoSuchElementException
(
)
;
}
try
{
line
=
reader
.
readLine
(
)
;
if
(
line
==
null
)
{
Util
.
closeQuietly
(
reader
)
;
}
}
catch
(
final
IOException
ex
)
{
savedException
=
ex
;
Util
.
closeQuietly
(
reader
)
;
}
return
prev
;
}
@
Override
public
void
remove
(
)
{
throw
new
UnsupportedOperationException
(
)
;
}
}
<EOF>
